module.exports=[56861,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),n=e.i(59756),o=e.i(61916),i=e.i(74677),s=e.i(69741),l=e.i(16795),d=e.i(87718),c=e.i(95169),u=e.i(47587),p=e.i(66012),f=e.i(70101),h=e.i(26937),m=e.i(10372),g=e.i(93695);e.i(52474);var w=e.i(220),y=e.i(89171),b=e.i(45959),N=e.i(63233);let _=process.env.TELEGRAM_BOT_TOKEN||"7404326987:AAHqwMnDmPY7xJdie9tl-YPB135fysSjH_4",R=process.env.NEXT_PUBLIC_APP_URL||"https://marketplace-bot.vercel.app/";async function k(e,t,a){let r={chat_id:e,text:t,parse_mode:"Markdown"};a&&(r.reply_markup=a),await fetch(`https://api.telegram.org/bot${_}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function T(){return{inline_keyboard:[[{text:"ðŸ› ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐœÐ°Ñ€ÐºÐµÑ‚",web_app:{url:R}}]]}}function $(){return{keyboard:[[{text:"ðŸ“± ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ð½Ð¾Ð¼ÐµÑ€Ð¾Ð¼",request_contact:!0}]],resize_keyboard:!0,one_time_keyboard:!0}}async function v(e){try{let t=await e.json();if(t.message){let e=t.message,a=e.chat.id,r=e.from||{},n=e.text||"",o=a.toString(),i=(0,b.getUser)(o);if(i||(i={id:a,username:r.username,firstName:r.first_name||"User",balance:0,level:1,rating:0,referralCount:0,createdAt:Date.now()},(0,b.setUser)(o,i)),e.contact){let t=e.contact.phone_number,r=(0,b.generateCode)();return(0,b.setVerificationCode)(o,r,t,"bot"),await k(a,`ðŸ“± *ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½!*

Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: \`${t}\`

ðŸ”‘ *Ð’Ð°Ñˆ ÐºÐ¾Ð´:* \`${r}\`

Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ð´ Ð² Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸.`,{remove_keyboard:!0}),setTimeout(()=>{k(a,"ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¼Ð°Ñ€ÐºÐµÑ‚ Ð¸ Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ð´:",T())},500),y.NextResponse.json({ok:!0})}if(e.web_app_data){let t=JSON.parse(e.web_app_data.data||"{}");if("verify_code"===t.action){let e=(0,b.getVerificationCode)(o);e&&e.code===t.code?((0,b.deleteVerificationCode)(o),(0,b.createSession)(o,e.phone),await k(a,"âœ… *ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð°!*\n\nÐ”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² MARKETPLACE!",T())):await k(a,"âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÐºÐ¾Ð´. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.")}else if("purchase"===t.action){let e=t.item||"NFT",r=t.price||0;await k(a,`ðŸŽ‰ *ÐŸÐ¾ÐºÑƒÐ¿ÐºÐ° ÑƒÑÐ¿ÐµÑˆÐ½Ð°!*

Ð’Ñ‹ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÐ»Ð¸: ${e}
Ð¦ÐµÐ½Ð°: ${r} TON`)}return y.NextResponse.json({ok:!0})}if(n.startsWith("/start")){let e=r.first_name||"Ð”Ñ€ÑƒÐ³",t=n.split(" ",2);if(t.length>1&&t[1].startsWith("gift_")){let e=t[1].slice(5),r=(0,b.getGiftShareByToken)(e);if(!r)return await k(a,"âŒ ÐŸÐ¾Ð´Ð°Ñ€Ð¾Ñ‡Ð½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° Ð¸Ð»Ð¸ Ð½ÐµÐ´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°."),y.NextResponse.json({ok:!0});if(r.isReceived)return await k(a,"âŒ Ð­Ñ‚Ð¾Ñ‚ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº ÑƒÐ¶Ðµ Ð±Ñ‹Ð» Ð¿Ñ€Ð¸Ð½ÑÑ‚."),y.NextResponse.json({ok:!0});if(!(0,b.acceptGiftShare)(e,o))return await k(a,"âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ñ€Ð¸Ð½ÑÑ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·."),y.NextResponse.json({ok:!0});try{let e,t=(0,b.getUserPhone)(o);if(t)e=t.phone;else{let t=(0,b.getAuthRequestByTelegramId)(o);t?.phone&&(e=t.phone)}let n=(0,N.parseNFTLink)(r.nftLink),i=n?.nftId||(r.nftName&&r.nftNumber?`${r.nftName}-${r.nftNumber}`:`gift_${Date.now()}`),s=n?.collectionName||(r.nftName?r.nftName.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,e=>e.toUpperCase()):"Unknown Collection"),l=n?.collectionSlug||r.nftName?.toLowerCase().replace(/[^a-z0-9]/g,"")||"unknown",d=n?.displayName||n?.giftName||(r.nftName&&r.nftNumber?`${r.nftName} #${r.nftNumber}`:r.nftName||i),c=n?.number||r.nftNumber||i.split("-")[1]||"preview",u=l.toLowerCase().replace(/[^a-z0-9]/g,"").replace(/-/g,""),p=`https://nft.fragment.com/gift/${u}/${c}.webp`,f=`https://nft.fragment.com/gift/${u}/${c}.json`;console.log(`[Webhook] Generated URLs: imageUrl=${p}, animationUrl=${f} (urlSlug=${u}, giftNumber=${c}, collectionSlug=${l})`);let h=await (0,b.addUserGift)(o,{nftId:i,collectionName:s,collectionSlug:l,phone:e||"unknown",telegramId:o,quantity:1,metadata:{giftName:d,rarity:"common",imageUrl:p,animationUrl:f}});if(h.success)console.log(`[Webhook] Gift added successfully to inventory: ${i}`);else{console.error(`[Webhook] Error adding gift to inventory: ${h.error}`);try{let e=await fetch(`${R}/api/telegram/download-gift`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegramId:o,gift_link:r.nftLink})}),t=await e.json();if(!t.success)return await k(a,"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ° Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ."),y.NextResponse.json({ok:!0});console.log(`[Webhook] Gift added via download-gift endpoint: ${t.message}`)}catch(e){return console.error(`[Webhook] Error using download-gift endpoint: ${e}`),await k(a,"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ° Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ."),y.NextResponse.json({ok:!0})}}let m=(0,b.getUser)(r.creatorTelegramId),g=m?.username||"Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ",w=`ðŸŽ *ÐŸÐ¾Ð´Ð°Ñ€Ð¾Ðº Ð¿Ñ€Ð¸Ð½ÑÑ‚!*

@${g} Ð¿ÐµÑ€ÐµÐ´Ð°Ð» Ð²Ð°Ð¼ [NFT Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº](${r.nftLink}) Ñ‡ÐµÑ€ÐµÐ· Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ Ð¾Ð±Ð¼ÐµÐ½Ð° Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ°Ð¼Ð¸ Getgems Ð¿Ñ€ÑÐ¼Ð¾ Ð² Ñ‡Ð°Ñ‚Ðµ Telegram.

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¾Ð½ Ð² Ð²Ð°ÑˆÐµÐ¼ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ðµ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ.`;await k(a,w,T())}catch(e){console.error("[Webhook] Error processing gift acceptance:",e),await k(a,"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ°.")}return y.NextResponse.json({ok:!0})}let s=n.match(/ref_(\d+)/);if(s&&!i.referredBy){let t=s[1];if(t!==o){(0,b.updateUser)(o,{referredBy:Number.parseInt(t)});let a=(0,b.getUser)(t);if(a){let r=a.referralCount+1,n=0;5===r?n=50:15===r?n=150:30===r?n=300:50===r&&(n=500),(0,b.updateUser)(t,{referralCount:r,balance:a.balance+n}),n>0&&await k(Number.parseInt(t),`ðŸŽ‰ *ÐÐ¾Ð²Ñ‹Ð¹ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»!*

${e} Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ð»ÑÑ Ð¿Ð¾ Ð²Ð°ÑˆÐµÐ¹ ÑÑÑ‹Ð»ÐºÐµ.

ðŸ’° Ð‘Ð¾Ð½ÑƒÑ: +${n} Ð±Ð°Ð»Ð»Ð¾Ð²`)}}}await k(a,`ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚, *${e}*!

Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² *MARKETPLACE* â€” Ñ‚Ð²Ð¾Ð¹ NFT Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹Ñ Ð² Telegram!

ðŸŽ *Ð§Ñ‚Ð¾ Ñ‚ÐµÐ±Ñ Ð¶Ð´ÐµÑ‚:*
â€¢ ÐŸÐ¾ÐºÑƒÐ¿Ð°Ð¹ Ð¸ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ð°Ð¹ NFT Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ¸
â€¢ Ð£Ñ‡Ð°ÑÑ‚Ð²ÑƒÐ¹ Ð² ÑÐµÐ·Ð¾Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÑ…
â€¢ ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐ°Ð¹ Ð´Ñ€ÑƒÐ·ÐµÐ¹ Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ð¹ Ð±Ð¾Ð½ÑƒÑÑ‹
â€¢ Ð—Ð°Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð¹ TON

ÐÐ°Ð¶Ð¼Ð¸ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð½Ð¸Ð¶Ðµ ðŸ‘‡`,T())}else if("/help"===n)await k(a,"ðŸ“š *Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ°*\n\n/start - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð°\n/market - ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼Ð°Ñ€ÐºÐµÑ‚\n/profile - ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ\n/referral - Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð°\n/auth - ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ",T());else if("/market"===n)await k(a,"ðŸ› ÐžÑ‚ÐºÑ€Ð¾Ð¹ Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹Ñ:",T());else if("/profile"===n){let e=(0,b.getUser)(o);await k(a,`ðŸ‘¤ *Ð¢Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ*

ðŸ’° Ð‘Ð°Ð»Ð°Ð½Ñ: *${e?.balance||0}* Ð±Ð°Ð»Ð»Ð¾Ð²
ðŸ”¥ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ: *${e?.level||1}*
â­ Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³: *${e?.rating||0}*`,{inline_keyboard:[[{text:"ðŸ‘¤ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ",web_app:{url:`${R}?tab=profile`}}]]})}else if("/referral"===n){let e=await fetch(`https://api.telegram.org/bot${_}/getMe`).then(e=>e.json()),t=e.result?.username||"MarketplaceBot",r=`https://t.me/${t}?start=ref_${a}`,n=i?.referralCount||0;await k(a,`ðŸ‘¥ *Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð°*

ðŸ”— *Ð¢Ð²Ð¾Ñ ÑÑÑ‹Ð»ÐºÐ°:*
\`${r}\`

ðŸ“Š *Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°:*
â€¢ ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¾: *${n}* Ð´Ñ€ÑƒÐ·ÐµÐ¹

ðŸ’° *ÐÐ°Ð³Ñ€Ð°Ð´Ñ‹:*
â€¢ 5 Ð´Ñ€ÑƒÐ·ÐµÐ¹ â†’ +50 Ð±Ð°Ð»Ð»Ð¾Ð²
â€¢ 15 Ð´Ñ€ÑƒÐ·ÐµÐ¹ â†’ +150 Ð±Ð°Ð»Ð»Ð¾Ð²
â€¢ 30 Ð´Ñ€ÑƒÐ·ÐµÐ¹ â†’ +300 Ð±Ð°Ð»Ð»Ð¾Ð²
â€¢ 50 Ð´Ñ€ÑƒÐ·ÐµÐ¹ â†’ +500 Ð±Ð°Ð»Ð»Ð¾Ð²`,{inline_keyboard:[[{text:"ðŸ“¤ ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ",switch_inline_query:`ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÐ¹ÑÑ Ðº MARKETPLACE! ${r}`}],[{text:"ðŸ‘¥ ÐŸÐ°Ñ€Ñ‚Ð½ÐµÑ€Ñ‹",web_app:{url:`${R}?tab=partners`}}]]})}else"/auth"===n?await k(a,"ðŸ” *ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ*\n\nÐ”Ð»Ñ Ð²Ñ…Ð¾Ð´Ð° Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ Ð½Ð¾Ð¼ÐµÑ€Ð¾Ð¼ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° ðŸ‘‡",$()):await k(a,"ðŸ‘‹ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð½Ð¸Ð¶Ðµ:",T())}if(t.inline_query){let e=t.inline_query,a=e.query?.trim()||"",r=e.from.id.toString(),n=await fetch(`https://api.telegram.org/bot${_}/getMe`).then(e=>e.json()),o=n.result?.username||"MarketplaceBot",i=[];if(a){let e=(0,N.parseNFTLink)(a);if(e){let t=(0,b.createGiftShare)(a,e.name,e.number,r),n=`ðŸŽ Ð’Ð°Ð¼ Ð´Ð°Ñ€ÑÑ‚ NFT: [${e.displayName}](${a})

Ð”Ð»Ñ Ð¿Ñ€Ð¸Ð½ÑÑ‚Ð¸Ñ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð½Ð¸Ð¶Ðµ.`;i=[{type:"article",id:`gift_${t.shareToken}`,title:`ðŸŽ ÐŸÐ¾Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ ${e.displayName}`,description:`NFT: ${e.displayName}`,input_message_content:{message_text:n,parse_mode:"Markdown"},reply_markup:{inline_keyboard:[[{text:"ðŸ“± ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ",url:a}],[{text:"ðŸŽ ÐŸÑ€Ð¸Ð½ÑÑ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº",url:`https://t.me/${o}?start=gift_${t.shareToken}`}]]}}]}else i=[{type:"article",id:"invalid_link",title:"ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° NFT",description:"ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° NFT",input_message_content:{message_text:"âŒ ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° NFT. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: http://t.me/nft/Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ-Ð½Ð¾Ð¼ÐµÑ€"}}]}else i=[{type:"article",id:"instruction",title:"ÐšÐ°Ðº ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ñ‡Ð½ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ",description:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° NFT Ð¿Ð¾ÑÐ»Ðµ @usernamebot",input_message_content:{message_text:"Ð”Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ñ‡Ð½Ð¾Ð¹ ÑÑÑ‹Ð»ÐºÐ¸ Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ: @usernamebot {ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° NFT}"}}];return await fetch(`https://api.telegram.org/bot${_}/answerInlineQuery`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inline_query_id:e.id,results:i,cache_time:1})}),y.NextResponse.json({ok:!0})}if(t.callback_query){let e=t.callback_query,a=e.message?.chat?.id,r=e.data;await fetch(`https://api.telegram.org/bot${_}/answerCallbackQuery`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({callback_query_id:e.id})}),"auth"===r&&a&&await k(a,"ðŸ” *ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ*\n\nÐ”Ð»Ñ Ð²Ñ…Ð¾Ð´Ð° Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ Ð½Ð¾Ð¼ÐµÑ€Ð¾Ð¼ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° ðŸ‘‡",$())}return y.NextResponse.json({ok:!0})}catch(e){return console.error("Webhook error:",e),y.NextResponse.json({ok:!0})}}e.s(["POST",()=>v],32343);var C=e.i(32343);let E=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/telegram/webhook/route",pathname:"/api/telegram/webhook",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/telegram/webhook/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:x,workUnitAsyncStorage:A,serverHooks:S}=E;function P(){return(0,r.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:A})}async function O(e,t,r){E.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/telegram/webhook/route";y=y.replace(/\/index$/,"")||"/";let b=await E.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:N,params:_,nextConfig:R,parsedUrl:k,isDraftMode:T,prerenderManifest:$,routerServerContext:v,isOnDemandRevalidate:C,revalidateOnlyGenerated:x,resolvedPathname:A,clientReferenceManifest:S,serverActionsManifest:P}=b,O=(0,s.normalizeAppPath)(y),U=!!($.dynamicRoutes[O]||$.routes[A]),j=async()=>((null==v?void 0:v.render404)?await v.render404(e,t,k,!1):t.end("This page could not be found"),null);if(U&&!T){let e=!!$.routes[A],t=$.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await j();throw new g.NoFallbackError}}let q=null;!U||E.isDev||T||(q="/index"===(q=A)?"/":q);let I=!0===E.isDev||!U,M=U&&!I;P&&S&&(0,i.setManifestsSingleton)({page:y,clientReferenceManifest:S,serverActionsManifest:P});let F=e.method||"GET",H=(0,o.getTracer)(),L=H.getActiveScopeSpan(),D={params:_,prerenderManifest:$,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,n)=>E.onRequestError(e,t,r,n,v)},sharedContext:{buildId:N}},B=new l.NodeNextRequest(e),G=new l.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(B,(0,d.signalFromNodeResponse)(t));try{let i=async e=>E.handle(K,D).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=H.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${F} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${y}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let d=async({previousCacheEntry:a})=>{try{if(!s&&C&&x&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=D.renderOpts.fetchMetrics;let l=D.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=D.renderOpts.collectedTags;if(!U)return await (0,p.sendResponse)(B,G,o,D.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,r=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:C})},!1,v),t}},c=await E.handleResponse({req:e,nextConfig:R,cacheKey:q,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:$,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:x,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:s});if(!U)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",C?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&U||g.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(B,G,new Response(c.value.body,{headers:g,status:c.value.status||200})),null};L?await l(L):await H.withPropagatedContext(e.headers,()=>H.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${y}`,kind:o.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:C})},!1,v),U)throw t;return await (0,p.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>P,"routeModule",()=>E,"serverHooks",()=>S,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>A],56861)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_974a9fde.js.map